#!/bin/zsh

function \?() {
setopt nocasematch

for id in "$@";do
	if [[ "$id" = http*://*youtu*be*/*watch\?v=[-_a-zA-Z0-9]* ]];then
		id="${id#http*://*youtu*be*/*watch\?v=}"
	elif [[ "$id" = http*://*youtu*be*/[-_a-zA-Z0-9]* ]];then
		id="${id#http*://*youtu*be*/}"
	fi
	echo "#search local(non /) pattern:$id"
	fnd_out=$(find /media/r/0 ~ -iname "*$id*" -exec ls -alF {} +)
	if [[ ! -z "$fnd_out" ]];then
		echo $fnd_out
		[[ "$fnd_out" =~ "[fF]ind.*[pP]ermission\sdenied.*" ]] && echo '$MATCH(stderr)':$MATCH #stderr inaccessible this way!
	fi
done
}

function srvstr() {
for srv in "$@";do
	sudo service "$srv" start
done
}

function srvstp() {
for srv in "$@";do
	sudo service "$srv" stop
done
}

function lpr() {
if [ $# -eq 0 ];then
	ll *part
else
	if [[ "$1" = */ ]];then
		ll "$1"*part
	else
		ll "$1"/*part
	fi
fi
}

function utmp3() {
	youtube-dl --youtube-skip-dash-manifest -R 21 --prefer-ffmpeg -x --audio-format mp3 --audio-quality 0 "$1" #to keep video: -k
}

function ut18() {
	youtube-dl --youtube-skip-dash-manifest -R 21 --prefer-ffmpeg -f 18 "$1"
}

function dprx() {
setopt nocasematch

if [[ $# -eq 1 ]];then
	if [[ "$1" == http ]];then
		echo "hit regex \"== http\""
		unset http_proxy
		unset HTTP_PROXY
	elif [[ "$1" == https ]];then
		echo "hit regex \"== https\""
		unset https_proxy
		unset HTTPS_PROXY
	elif [[ "$1" == ftp ]];then
		echo "hit regex \"== ftp\""
		unset ftp_proxy
		unset FTP_PROXY
	elif [[ "$1" =~ sock* ]];then
		echo "hit regex \"=~ sock\""
		unset socks_proxy
		unset SOCKS_PROXY
	fi
elif [[ $# -eq 0 ]];then
		unset http_proxy
		unset HTTP_PROXY
		unset https_proxy
		unset HTTPS_PROXY
		unset ftp_proxy
		unset FTP_PROXY
		unset socks_proxy
		unset SOCKS_PROXY
fi

echo "http_proxy:$http_proxy"
echo "https_proxy:$https_proxy"
echo "ftp_proxy:$ftp_proxy"
echo "socks_proxy:$socks_proxy"
echo "HTTP_PROXY:$HTTP_PROXY"
echo "HTTPS_PROXY:$HTTPS_PROXY"
echo "FTP_PROXY:$FTP_PROXY"
echo "SOCKS_PROXY:$SOCKS_PROXY"
}

function prprx() { 
echo "http_proxy:$http_proxy"
echo "https_proxy:$https_proxy"
echo "ftp_proxy:$ftp_proxy"
echo "socks_proxy:$socks_proxy"
echo "no_proxy:$no_proxy"
echo "HTTP_PROXY:$HTTP_PROXY"
echo "HTTPS_PROXY:$HTTPS_PROXY"
echo "FTP_PROXY:$FTP_PROXY"
echo "SOCKS_PROXY:$SOCKS_PROXY"
echo "NO_PROXY:$NO_PROXY"
}

function --() { #clean
rm -rf ~/.cache ~/.Trash ~/.thumbnails ~/.Thumbnails ~/.local/share/Trash ~/.local/share/trash 
sudo apt autoremove -y
sudo apt autoclean
#E: encountered a section with no package: header
#E: problem with Mergelist/var/lib/apt/lists
#sudo rm -Rf /var/lib/apt/lists/* -vf
}

function +() { #append to todo file
if [[ $# > 0 ]];then
	echo "$@" >> /media/r/0/gthb/неkod/.todo
fi
}

function ++() { #append to youtube download file
if [[ $# > 0 ]];then
	echo "$@" >> dwn
fi
}

function upgrlog() { #view cron job upgrade cmd log
if [[ -f /var/log/sys_upgrade.log ]];then
	less /var/log/sys_upgrade.log
elif [[ -f /var/log/youtube-dl_upgrade.log ]];then
	less /var/log/youtube-dl_upgrade.log
fi
}

function vd() {
vlc "$@" &> /dev/null &
}

function vlopt() {
vlc --longhelp --advanced
}

function utup() {
setopt nocasematch

xt_code=113
out_msg="error"
counter=0
while [[ $xt_code -ne 0 || "$out_msg" =~ error ]];do #1.ERROR: can't find the current version. Please try again later. 2.Updating to version 2016.08.22 ...\nERROR: unable to download latest version (for error 2,better to detect network connection and exit if connection lost)
	if [[ $((counter++)) -gt 4 ]];then
		return 113
	fi
	out_msg=$(sudo youtube-dl -U)
	xt_code=$?
	echo "#debug:counter:$counter"
	echo '#debug:regexp:$match:['$match'],$MATCH:['$MATCH']'
	echo "#debug:youtube-dl -U exit code:$xt_code"
	echo "#debug:youtube-dl -U output message:$out_msg"
done
}

function fx() {
firefox --ssl-version-min=tls1.2 -private "$@" &> /dev/null &
}

function krm() {
google-chrome-stable --ssl-version-min=tls1.2 --incognito weblio.jp merriam-webster.com "$@" &> /dev/null &
}

function 0p() {
#echo '$#':$#
if [[ $# -eq 1 && "$1" =~ [0-9]+ ]];then
	sudo shutdown -P -f "$1"
else
	sudo shutdown -P -f 0
fi
}

function dwn() {
setopt nocasematch

for file in $(find /media/r/0 ~ -type f -iname 'dwn*');do
	if [[ "$file" != "[fF]ind.*[pP]ermission\sdenied.*" ]];then #stderr inaccessible this way!
		echo $file:
		more $file
	fi
done
}

function ss() {
sudo apt update && sudo apt upgrade -y
utup
}

function putfio() {
# Load module
zmodload zsh/pcre

if [[ $# -eq 1 ]];then
	curl -F "file=@$1" 'https://file.io/?expires=3d'
	echo '$?':$?
elif [[ $# -eq 2 && "$2" -pcre-match "\d{1,3}[dmwDMW]" ]];then
	echo '#debug:-pcre-match:$MATCH:['$MATCH'],array $match:['$match']'
	curl -F "file=@$1" "https://file.io/?expires=$2"
	echo '$?':$?
else
	echo "usage: putfio <id> [(expires=)<9d/3m/7w>]"
#define EX_USAGE 64 /* command line usage error */
	return 64
fi
}

function getfio() {
if [[ $# -eq 2 ]];then
	curl -o "$2.7z" "https://file.io/$1"
	echo '$?':$?
elif [[ $# -eq 1 ]];then
	curl -o "$1.7z" "https://file.io/$1"
	echo '$?':$?
else
	echo "usage: getfio <id> [output_file_name_without_suffix]"
#define EX_USAGE 64 /* command line usage error */
	return 64
fi
}

function sjis2utf8() {
if [[ $# -eq 1 ]];then
	basename=${1%\.*}
	extension=${1##*\.}
	echo 'file base name:${file%\.*}':$basename
	echo 'file extension:${file##*\.}':$extension
	iconv -f SHIFT-JIS -t UTF-8 "$1" > "${basename}_utf8.${extension}"
	#iconv -t UTF-8 "$1" > "${basename}_utf8.${extension}"
	echo '$?':$?
fi
}
